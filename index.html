<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Block.js</title>
    <style>
        html,body,canvas { margin: 0; padding: 0; width: 100%; height: 100%; font-size: 0; }
    </style>
</head>
<body>
    <!-- Version 0.6.2 -->
    <script src="./cannon.js"></script>
    <!-- Version 3.2.0 -->
    <script src="./babylon.js"></script>
    <script src="./components/Constants.js"></script>
    <script src="./components/Player.js"></script>
    <script src="./components/Brick.js"></script>
    <script src="./components/BrickPlace.js"></script>
    <script src="./components/Debug.js"></script>
    <canvas id="render-canvas"></canvas>
    <script>
        var lastId = 0;
        var yVel = 0;

        var canvas = document.getElementById("render-canvas");
        var engine = new BABYLON.Engine(canvas);
        var scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0.8, 0.8, 0.8);
            scene.gravity = GRAVITY;
            scene.collisionsEnabled = false;
        
        var light = new BABYLON.PointLight("light", new BABYLON.Vector3(10, 10, 0), scene);
        
        // debugDrawGrid();

        // Make bricks for GPU copying
        var brick1x1red = new Brick("Brick1", 1, 1, 1, new BABYLON.Vector3(0,1,0), COLORRED, scene);
        var brick1x1green = new Brick("Brick1", 1, 1, 1, new BABYLON.Vector3(0,1,0), COLORGREEN, scene);
        var brick1x1blue = new Brick("Brick1", 1, 1, 1, new BABYLON.Vector3(0,1,0), COLORBLUE, scene);
        var brick1x1default = new Brick("Brick1", 1, 1, 1, new BABYLON.Vector3(0,1,0), COLORDEFAULT, scene);

        function canPlaceBrick(brick) {
            return true;
        }
        function placeBrick(width, height, depth, x, y, z, color) {
            var newBrick; // A Mesh
            color = color.trim().toLowerCase();
            if(width == 1 && height == 1 && depth == 1) {
                if(color === "red") {
                    newBrick = brick1x1red.makeDuplicate(new BABYLON.Vector3(x, y, z));
                }
                else if (color === "green") {
                    newBrick = newBrick = brick1x1green.makeDuplicate(new BABYLON.Vector3(x, y, z));
                }
                else if (color === "blue") {
                    newBrick = newBrick = brick1x1blue.makeDuplicate(new BABYLON.Vector3(x, y, z));
                }
                else {
                    newBrick = brick1x1default.makeDuplicate(new BABYLON.Vector3(x, y, z));
                }
            }
            else {
                console.log("Invalid brick specified!");
                return;
            }
            if(!canPlaceBrick()) {
                return;
            }
        }

        var ground = BABYLON.MeshBuilder.CreateGround("Ground", {height: FLOOR_WIDTH, width: FLOOR_WIDTH, subdivision: FLOOR_WIDTH / 2}, scene);
            ground.checkCollisions = true;
            ground.position = new BABYLON.Vector3(0, 0, 0);
            ground.isPickable = true;

        var player1 = new Player("Player1", {}, scene);
            player1.root.position = new BABYLON.Vector3(0, 15, -20);
        
        placeBrick(1,1,1, 1,1,0, "red");

        var renderLoop = function() {
            scene.render();
            player1.movement();
        }
        engine.runRenderLoop(renderLoop);
    </script>
</body>
</html>